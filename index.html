<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í–æ—Ä–∫–•–æ–º ‚Äî –≤—ã —Ö–æ—Ç–∏—Ç–µ –º—ã –¥–µ–ª–∞–µ–º</title>

    <meta http-equiv="Content-Security-Policy" content="default-src * self blob: data: gap:; style-src * self 'unsafe-inline' blob: data: gap:; script-src * 'self' 'unsafe-eval' 'unsafe-inline' blob: data: gap:; object-src * 'self' blob: data: gap:; img-src * self 'unsafe-inline' blob: data: gap:; connect-src self * 'unsafe-inline' blob: data: gap:; frame-src * self blob: data: gap:;">
    
    <!-- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <!-- –®—Ä–∏—Ñ—Ç—ã -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- –ù–∞—à–∏ —Å—Ç–∏–ª–∏ -->
    <!-- –í HEAD, –ø–æ—Å–ª–µ main.css -->
<link rel="stylesheet" href="css/main.css">
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="css/animations.css">
</head>
<body>
    <div class="container py-4">
        <!-- –®–∞–ø–∫–∞ —Å –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–º –¥–æ–º–∏–∫–æ–º -->
        <header>
            <a href="index.html" class="logo-link">
                <i class="fas fa-house"></i>
                <span>–í–æ—Ä–∫–•–æ–º</span>
            </a>
            <nav>
                <a href="index.html" class="active">–ì–ª–∞–≤–Ω–∞—è</a>
                <a href="client.html" id="clientLink">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</a>
                <a href="masters.html" id="masterLink">–ú–∞—Å—Ç–µ—Ä–∞–º</a>
                <button class="btn btn-sm btn-outline-secondary rounded-pill" id="themeToggle">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="header-logout-btn" id="headerLogoutBtn" style="display: none;">
                    <i class="fas fa-sign-out-alt"></i> –í—ã–π—Ç–∏
                </button>
            </nav>
        </header>

        <!-- –ë–ª–æ–∫ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
        <div id="authBlockContainer"></div>

        <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ -->
        <div id="userInfoBlock" class="bg-white rounded-5 p-4 mb-4 shadow-sm d-none">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h5>üë§ –í—ã –≤–æ—à–ª–∏ –∫–∞–∫ <span id="userEmailDisplay"></span></h5>
                    <p id="userRoleDisplay" class="mb-0" style="color: var(--accent);"></p>
                    <div id="masterBadges" class="d-flex gap-2 mt-2"></div>
                </div>
                <button id="logoutBtn" class="btn btn-outline-secondary">–í—ã–π—Ç–∏</button>
            </div>
        </div>

        <!-- –£–º–Ω—ã–π –ø–æ–∏—Å–∫ -->
        <div class="search-section mb-5">
            <div class="row g-2">
                <div class="col-md-10">
                    <div class="position-relative">
                        <input type="text" id="smartSearch" class="search-input w-100" 
                               placeholder="üîç –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å? –ù–∞–ø—Ä–∏–º–µ—Ä: –ø–æ—á–∏–Ω–∏—Ç—å –∫—Ä–∞–Ω, —Å–æ–±—Ä–∞—Ç—å –∫—É—Ö–Ω—é, –ø–æ–ª–æ–∂–∏—Ç—å –ø–ª–∏—Ç–∫—É...">
                        <div id="searchSuggestions" class="search-suggestions d-none"></div>
                    </div>
                </div>
                <div class="col-md-2">
                    <button class="btn w-100 pulse" id="searchBtn">
                        <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                    </button>
                </div>
            </div>
        </div>

        <!-- –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º -->
        <div class="filter-section">
            <h5 class="mb-3"><i class="fas fa-filter" style="color: var(--accent);"></i>–§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h5>
            <div class="category-filter" id="categoryFilter">
                <button class="category-filter-btn active" data-category="all">–í—Å–µ</button>
                <button class="category-filter-btn" data-category="–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞">üö∞ –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</button>
                <button class="category-filter-btn" data-category="–≠–ª–µ–∫—Ç—Ä–∏–∫–∞">‚ö° –≠–ª–µ–∫—Ç—Ä–∏–∫–∞</button>
                <button class="category-filter-btn" data-category="–û—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">üé® –û—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</button>
                <button class="category-filter-btn" data-category="–ú–µ–±–µ–ª—å">ü™ë –ú–µ–±–µ–ª—å</button>
                <button class="category-filter-btn" data-category="–û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏">ü™ü –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏</button>
                <button class="category-filter-btn" data-category="–ë—ã—Ç–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç">üîß –ë—ã—Ç–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç</button>
                <button class="category-filter-btn" data-category="–ö–ª–∏–Ω–∏–Ω–≥">üßπ –ö–ª–∏–Ω–∏–Ω–≥</button>
                <button class="category-filter-btn" data-category="–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏">üì∫ –†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏</button>
            </div>
        </div>

        <!-- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
        <div class="row g-4 mb-5" id="orderFormRow">
            <div class="col-md-6" id="orderFormColumn">
                <div class="card">
                    <h3 class="mb-4 d-flex align-items-center gap-2">
                        <i class="fas fa-plus-circle" style="color: var(--accent);"></i>
                        –û—Å—Ç–∞–≤–∏—Ç—å –∑–∞—è–≤–∫—É
                    </h3>
                    <form id="orderForm">
                        <div class="mb-3">
                            <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                            <select id="category" class="form-select" required>
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                <option value="–°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞">üö∞ –°–∞–Ω—Ç–µ—Ö–Ω–∏–∫–∞</option>
                                <option value="–≠–ª–µ–∫—Ç—Ä–∏–∫–∞">‚ö° –≠–ª–µ–∫—Ç—Ä–∏–∫–∞</option>
                                <option value="–û—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã">üé® –û—Ç–¥–µ–ª–æ—á–Ω—ã–µ —Ä–∞–±–æ—Ç—ã</option>
                                <option value="–ú–µ–±–µ–ª—å">ü™ë –ú–µ–±–µ–ª—å / —Å–±–æ—Ä–∫–∞</option>
                                <option value="–û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏">ü™ü –û–∫–Ω–∞ –∏ –¥–≤–µ—Ä–∏</option>
                                <option value="–ë—ã—Ç–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç">üîß –ë—ã—Ç–æ–≤–æ–π —Ä–µ–º–æ–Ω—Ç</option>
                                <option value="–ö–ª–∏–Ω–∏–Ω–≥">üßπ –ö–ª–∏–Ω–∏–Ω–≥</option>
                                <option value="–†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏">üì∫ –†–µ–º–æ–Ω—Ç —Ç–µ—Ö–Ω–∏–∫–∏</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <input type="text" id="title" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∫–æ–≤–∏–Ω—É" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea id="description" class="form-control" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–ë—é–¥–∂–µ—Ç (‚ÇΩ)</label>
                            <input type="number" id="price" class="form-control" min="500" value="3000" required>
                            <div id="aiPriceHint" class="mt-2"></div>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">–§–æ—Ç–æ –ø—Ä–æ–±–ª–µ–º—ã (–¥–æ 5 —à—Ç)</label>
                            <div class="upload-area" id="uploadArea">
                                <i class="fas fa-cloud-upload-alt fa-2x mb-2"></i>
                                <p>–ù–∞–∂–º–∏—Ç–µ –∏–ª–∏ –ø–µ—Ä–µ—Ç–∞—â–∏—Ç–µ —Ñ–æ—Ç–æ</p>
                                <input type="file" id="photoInput" multiple accept="image/*" style="display: none;">
                            </div>
                            <div id="photoPreview" class="d-flex flex-wrap gap-2 mt-2"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–ê–¥—Ä–µ—Å</label>
                            <input type="text" id="address" class="form-control" placeholder="—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10, –∫–≤. 5" required>
                        </div>
                        
                        <div class="mb-3">
                            <div class="row g-2">
                                <div class="col">
                                    <input type="text" id="latitude" class="form-control" placeholder="–®–∏—Ä–æ—Ç–∞" readonly>
                                </div>
                                <div class="col">
                                    <input type="text" id="longitude" class="form-control" placeholder="–î–æ–ª–≥–æ—Ç–∞" readonly>
                                </div>
                            </div>
                            <div id="map" class="mt-2" style="height: 250px;"></div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–í–∞—à–µ –∏–º—è</label>
                            <input type="text" id="clientName" class="form-control" placeholder="–ò–º—è" required>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                            <input type="tel" id="phone" class="form-control" placeholder="+7 (999) 123-45-67" required>
                        </div>
                        
                        <button type="submit" class="btn w-100 py-3">
                            <i class="fas fa-paper-plane"></i> –û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å –∑–∞—è–≤–∫—É
                        </button>
                    </form>
                    
                    <div id="successMessage" class="alert alert-success mt-3 d-none">
                        ‚úÖ –ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –ú–∞—Å—Ç–µ—Ä–∞ —É–≤–∏–¥—è—Ç –µ—ë –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç.
                    </div>
                </div>
            </div>
            
            <!-- –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤ -->
            <div class="col-md-6" id="ordersColumn">
                <div class="card">
                    <h3 class="mb-4 d-flex align-items-center gap-2">
                        <i class="fas fa-list" style="color: var(--accent);"></i>
                        –°–≤–µ–∂–∏–µ –∑–∞—è–≤–∫–∏
                    </h3>
                    <div id="ordersList"></div>
                    <button id="refreshBtn" class="btn btn-outline-secondary w-100 mt-3">
                        <i class="fas fa-sync-alt"></i> –û–±–Ω–æ–≤–∏—Ç—å
                    </button>
                </div>
            </div>
        </div>

        <!-- –†–µ–π—Ç–∏–Ω–≥–∏ –º–∞—Å—Ç–µ—Ä–æ–≤ -->
        <div class="row g-4 mb-5">
            <div class="col-12">
                <div class="card">
                    <h3 class="mb-4 d-flex align-items-center gap-2">
                        <i class="fas fa-trophy" style="color: var(--accent);"></i>
                        –†–µ–π—Ç–∏–Ω–≥ –º–∞—Å—Ç–µ—Ä–æ–≤
                    </h3>
                    
                    <div id="topMastersList" class="row g-4"></div>
                </div>
            </div>
        </div>

        <!-- –ö–∞—Ä—Ç–∞ –∑–∞–∫–∞–∑–æ–≤ -->
        <div class="col-12 mb-5">
            <div class="card">
                <h3 class="mb-4 d-flex align-items-center gap-2">
                    <i class="fas fa-map-marked-alt" style="color: var(--accent);"></i>
                    –ó–∞—è–≤–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
                </h3>
                <div id="ordersMap" style="width: 100%; height: 450px;"></div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª–∫–∞ QR-–∫–æ–¥–∞ -->
    <div class="modal fade" id="qrModal" tabindex="-1">
        <div class="modal-dialog modal-sm">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="fas fa-qrcode"></i> QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center">
                    <div id="qrCode" style="padding: 20px;"></div>
                    <p class="mt-3 text-secondary" id="qrOrderInfo"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- –°–∫—Ä–∏–ø—Ç—ã: –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ -->
    <script src="https://api-maps.yandex.ru/2.1/?apikey=22f2217d-9d6c-44f6-b96b-94e396067a8e&lang=ru_RU" type="text/javascript"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

       <!-- –ù–∞—à–∏ –º–æ–¥—É–ª–∏ -->
   <!-- –ù–∞—à–∏ –º–æ–¥—É–ª–∏ -->
<script src="js/utils/constants.js"></script>
<script src="js/utils/helpers.js"></script>
<script src="js/services/firebase.js"></script>
<script src="js/services/auth.js"></script>
<script src="js/services/orders.js"></script>
<script src="js/services/chat.js"></script>
<script src="js/services/badges.js"></script>
<script src="js/services/moderation.js"></script>
<script src="js/components/auth-ui.js"></script>
<!-- –ù–ï –ù–ê–î–û masters.js! -->

<!-- –°–∫—Ä–∏–ø—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã -->
<script src="js/pages/index.js"></script>
    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ Service Worker -->
<script>
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('firebase-messaging-sw.js')
    .then(reg => console.log('‚úÖ Service Worker –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω'))
    .catch(err => console.log('‚ùå –û—à–∏–±–∫–∞ Service Worker:', err));
}
</script>
</body>
</html>